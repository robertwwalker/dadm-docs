<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robert W. Walker">

<title>Pivoting: Wide and Long</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="index_files/libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="index_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="index_files/libs/datatables-binding-0.26/datatables.js"></script>
<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="index_files/libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="index_files/libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="index_files/libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="index_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="index_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="index_files/libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="index_files/libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="index_files/libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="index_files/libs/selectize-0.12.0/selectize.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overarching-theme" id="toc-overarching-theme" class="nav-link active" data-scroll-target="#overarching-theme">Overarching Theme</a></li>
  <li><a href="#package-and-some-details" id="toc-package-and-some-details" class="nav-link" data-scroll-target="#package-and-some-details">Package and Some Details</a></li>
  <li><a href="#a-tidy-table" id="toc-a-tidy-table" class="nav-link" data-scroll-target="#a-tidy-table">A Tidy Table</a>
  <ul>
  <li><a href="#pivoting-from-long-to-wide" id="toc-pivoting-from-long-to-wide" class="nav-link" data-scroll-target="#pivoting-from-long-to-wide">Pivoting from Long to Wide</a></li>
  <li><a href="#pivoting-from-wide-to-long" id="toc-pivoting-from-wide-to-long" class="nav-link" data-scroll-target="#pivoting-from-wide-to-long">Pivoting from Wide to Long</a></li>
  </ul></li>
  <li><a href="#a-more-complicated-example-from-the-wild-intel-10-k" id="toc-a-more-complicated-example-from-the-wild-intel-10-k" class="nav-link" data-scroll-target="#a-more-complicated-example-from-the-wild-intel-10-k">A More Complicated Example From the Wild: Intel 10-k</a>
  <ul>
  <li><a href="#plot-some-financials" id="toc-plot-some-financials" class="nav-link" data-scroll-target="#plot-some-financials">Plot Some Financials</a></li>
  </ul></li>
  <li><a href="#a-really-wide-and-messy-example-weather" id="toc-a-really-wide-and-messy-example-weather" class="nav-link" data-scroll-target="#a-really-wide-and-messy-example-weather">A Really Wide and Messy Example: Weather</a>
  <ul>
  <li><a href="#removing-junk" id="toc-removing-junk" class="nav-link" data-scroll-target="#removing-junk">Removing Junk</a></li>
  <li><a href="#a-plot-to-test-the-data" id="toc-a-plot-to-test-the-data" class="nav-link" data-scroll-target="#a-plot-to-test-the-data">A Plot to Test the Data</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pivoting: Wide and Long</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Robert W. Walker </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overarching-theme" class="level1">
<h1>Overarching Theme</h1>
<p>In a 2014 paper in the <strong>Journal of Statistical Software</strong>, {citation: Wickham, H. (2014). Tidy Data. Journal of Statistical Software, 59(10), 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">DOI</a>} available from the <a href="https://www.jstatsoft.org/article/view/v059i10">following link</a>, Hadley Wickham provides the following succinct definition of <strong>tidy data</strong> – data that accords with three key properties.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/Screenshot%202023-02-01%20at%204.43.55%20PM.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">tidy data</figcaption><p></p>
</figure>
</div>
<p>The raison d’etre for pivoting operations examined in this post is the manipulation of <em>untidy</em> data into a tidy format.</p>
</section>
<section id="package-and-some-details" class="level1">
<h1>Package and Some Details</h1>
<p>The tidyverse collection contains two types of two <code>pivot_</code> operations: <code>pivot_wider</code> and <code>pivot_longer</code> for transforming data from long to wide [<code>pivot_wider</code>] and wide to long [<code>pivot_longer</code>] formats in the <code>library(tidyr)</code>. This quarto document will examine them and their use.</p>
<ol type="1">
<li>let us verify that they are a part of the <code>tidyverse</code>. You will notice <code>tidyr</code> among the packages being attached.</li>
</ol>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_a22914e5f5ea233752a1387858c2c491">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0      ✔ purrr   1.0.1 
✔ tibble  3.1.8      ✔ dplyr   1.0.10
✔ tidyr   1.2.1      ✔ stringr 1.5.0 
✔ readr   2.1.3      ✔ forcats 0.5.2 
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>They are accompanied by a <strong>vignette</strong>; a vignette is essentially an extended help file to detail the use of some R commands. It can be accessed by making certain that the <code>tidyverse</code> [or just <code>tidyr</code>] is loaded [with either <code>library(tidyverse)</code> or <code>library(tidyr)</code>] and then</li>
</ol>
<pre><code>vignette("pivot")</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/Screen%20Shot%202023-02-01%20at%201.13.29%20AM.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">A view of the vignette obtained by vignette(“pivot”)</figcaption><p></p>
</figure>
</div>
<p>The data is contained in the packages so you can follow along and experiment with it, if you so choose. Some of the examples overlap with the paper cited above.</p>
<p>I want to first use an example deploying familiar data: the dataset on Bond Funds. Let’s load it and I will use <code>datatable</code> from the <code>DT</code> package to display it.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_69c0986bb6e94e74abc4415979a7c333">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/robertwwalker/DADMStuff/raw/master/Week-3-Data.RData"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(Bonds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a8bc59f371f5e643ad0d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a8bc59f371f5e643ad0d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184"],["FN-1","FN-2","FN-3","FN-4","FN-5","FN-6","FN-7","FN-8","FN-9","FN-10","FN-11","FN-12","FN-13","FN-14","FN-15","FN-16","FN-17","FN-18","FN-19","FN-20","FN-21","FN-22","FN-23","FN-24","FN-25","FN-26","FN-27","FN-28","FN-29","FN-30","FN-31","FN-32","FN-33","FN-34","FN-35","FN-36","FN-37","FN-38","FN-39","FN-40","FN-41","FN-42","FN-43","FN-44","FN-45","FN-46","FN-47","FN-48","FN-49","FN-50","FN-51","FN-52","FN-53","FN-54","FN-55","FN-56","FN-57","FN-58","FN-59","FN-60","FN-61","FN-62","FN-63","FN-64","FN-65","FN-66","FN-67","FN-68","FN-69","FN-70","FN-71","FN-72","FN-73","FN-74","FN-75","FN-76","FN-77","FN-78","FN-79","FN-80","FN-81","FN-82","FN-83","FN-84","FN-85","FN-86","FN-87","FN-88","FN-89","FN-90","FN-91","FN-92","FN-93","FN-94","FN-95","FN-96","FN-97","FN-98","FN-99","FN-100","FN-101","FN-102","FN-103","FN-104","FN-105","FN-106","FN-107","FN-108","FN-109","FN-110","FN-111","FN-112","FN-113","FN-114","FN-115","FN-116","FN-117","FN-118","FN-119","FN-120","FN-121","FN-122","FN-123","FN-124","FN-125","FN-126","FN-127","FN-128","FN-129","FN-130","FN-131","FN-132","FN-133","FN-134","FN-135","FN-136","FN-137","FN-138","FN-139","FN-140","FN-141","FN-142","FN-143","FN-144","FN-145","FN-146","FN-147","FN-148","FN-149","FN-150","FN-151","FN-152","FN-153","FN-154","FN-155","FN-156","FN-157","FN-158","FN-159","FN-160","FN-161","FN-162","FN-163","FN-164","FN-165","FN-166","FN-167","FN-168","FN-169","FN-170","FN-171","FN-172","FN-173","FN-174","FN-175","FN-176","FN-177","FN-178","FN-179","FN-180","FN-181","FN-182","FN-183","FN-184"],["Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Intermediate Government","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate","Short Term Corporate"],[7268.1,475.1,193,18603.5,142.6,1401.6,985.6,2188.8,390.6,544.1,1407.4,155.5,397.5,906.1,379.1,62.7,1539.1,167.3,448,238.1,557.8,192.7,261.8,135.8,1807.3,4615.4,86.2,291.1,6332.5,110.7,619.7,628.7,274.3,891.8,94.7,676.3,1182.1,135.9,588.8,40,1080.4,309.1,4472.2,498.7,278.2,1525.5,556.6,588.6,332.5,84.9,17.3,104.1,530.7,333.6,1133.3,322.5,123.8,425.6,184.7,122.7,107.2,135.6,82.2,305.7,551.3,24.2,661.2,154.6,106.9,1011.1,634.8,168.7,792.1,583.5,56.1,285.5,640.3,84.7,81.3,611.7,595.1,131.3,88,686.6,3531.8,358,33,139.1,123.9,1922,203.4,66.1,1346,4772.9,77.5,76.2,146.3,49.2,96.1,226.8,122.3,725.9,1248.4,36.5,127.4,605.2,1879.2,964.7,325.3,69.8,177.8,156.6,244.9,475.5,46.1,181.3,63.8,135.4,388,18.6,298.1,461.3,159.9,3662.7,42.6,111.4,114.5,5282.9,17.4,518,262.5,93.9,1130,1101.9,49.9,640.3,477.4,569.4,36.8,145.4,148.9,195.8,2361.1,12.4,26.3,681,486.1,10744.6,108.9,69,128.3,374.4,280.6,456.2,16297.1,517,80.5,119.3,88.3,5701.6,478.4,369.3,297.4,230.6,115.7,6981.5,190.1,278.4,246.1,143.8,1469.6,80,95.5,170.5,95.4,237.1,983,51.9,249.7,33.8,249.8,52.9,39.7,182.3],["No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","Yes","No","No","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","Yes","Yes","No","No","Yes","No","Yes","Yes","No","No","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No","No","No","Yes","Yes","No","No","No","No","Yes","No","Yes","No","No","No","Yes","Yes","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","Yes","No","No","Yes","No","No","Yes","No","No","No","No","No","Yes","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","Yes","No","No","Yes","No","No","Yes","No","No","No","Yes","No","No","Yes","No","No","No","No","No","No","Yes","No","No","Yes","No","Yes","No","No","Yes","No","No","Yes","No","No","No","Yes","No","No","No","No","No","Yes","No","No","No"],[0.45,0.5,0.71,0.13,0.6,0.54,0.49,0.55,0.67,0.63,0.45,0.91,0.6,0.51,0.57,0.74,0.66,0.6,0.77,1.13,0.74,0.7,1.08,0.65,0.8,0.45,0.61,1.1,0.73,1.08,0.96,0.55,0.8,0.88,0.83,0.93,0.92,0.47,0.96,1.94,0.95,0.98,0.64,0.95,0.2,0.13,0.94,0.96,1,0.71,1.58,0.95,0.92,0.37,0.46,1.13,0.75,0.97,1.03,0.26,0.9,1.15,0.57,0.99,0.52,0.52,0.97,0.9,0.79,0.87,0.9,0.99,1,0.5,0.65,0.36,0.27,1,1.16,0.51,0.55,0.65,0.82,0.94,0.12,1.06,1,0.51,0.32,1.08,1,0.71,0.65,0.56,0.51,0.68,0.55,0.6,0.73,0.45,0.53,0.68,0.72,0.76,0.45,0.3,0.48,0.85,0.53,0.9,0.94,0.63,0.81,0.91,0.92,0.36,0.62,0.7,0.56,0.89,0.51,0.46,0.8,0.52,0.74,0.97,0.65,0.22,0.75,0.72,0.85,0.74,0.86,0.64,0.6,0.54,0.6,0.52,0.38,0.9,1.1,0.52,0.8,0.7,0.49,0.75,0.5,0.46,0.63,0.98,0.55,0.73,0.99,0.37,0.14,0.65,0.7,0.82,0.92,0.69,0.64,0.86,1.05,0.95,0.7,0.45,0.5,0.85,0.75,0.8,1.08,0.7,0.66,0.46,1.02,0.5,0.6,0.7,0.55,0.53,0.43,0.87,0.51,0.53],[6.9,9.8,6.3,5.4,5.9,5.7,3,7.4,5.3,5.7,0.9,12.4,6,8.1,5.7,4.5,6.4,5.8,10.1,4.4,9,3.2,3.5,-1.1,7.8,1.3,-0.2,5.1,4.8,1.9,5,2.1,12.7,4.2,3.5,22.3,28.6,13,5.2,17.1,3.5,0,2.2,0.9,-3.8,-0.7,7.9,6.2,3.7,11.2,2.1,-3.6,4.6,12,3.4,4.7,6.4,9.1,1.7,-3.6,0.1,3.7,-3.3,3,-1.4,0.7,0,2.9,-4.8,1.4,7.3,-2.9,1.2,6,0.7,7.1,0.2,-0.6,7,6.5,5.5,-3.8,2,7.2,-1.6,0.5,0.2,5.5,5,12.1,8.3,6.8,8.6,5,2.2,2.5,12.2,10,7.3,2.9,7.3,15.5,14,5.5,3.6,8.1,9.6,12.9,10.7,6,8.2,12,16.4,6,5.4,4.9,8.6,6.8,6.7,4.1,11.2,8.4,5.9,9,5.4,9.1,9.5,4.3,2.8,10.8,9.5,9.4,13.2,13,1.6,7,12.9,12,3.6,10.1,7.7,7.2,17.4,3.4,4,11.3,10.3,13.4,11.4,5.2,8.8,13.2,16.6,13.6,14.2,10.6,13.4,6,4.5,6.7,6.8,13.5,12.8,13.9,11.5,7.3,11.6,15.5,11.9,24.8,29.7,9.9,19.2,15.6,1.5,14.5,15.2,13.4,2.4,16.4,6.7,5.2,-8.8,32],[6.9,7.5,7,6.6,6.7,6.4,6.8,6.4,6.1,6.2,6.2,6.4,6.3,6.1,6.6,7.8,6.2,6.2,6.5,5.5,6,6,5.1,6,6.1,6.7,5.6,5.8,6,5.4,5.9,6.3,6.1,6.6,6.4,9.4,9.4,5.1,6.7,6.6,6,5.8,5.5,4.9,6,7.1,5.5,5.1,4.7,3.9,4.9,4.7,5.5,4.9,2.3,5.6,3.3,4.7,5.6,6.1,5.3,5.9,5.1,6.2,7.3,-0.1,3.2,2.4,5.6,1.6,3.7,6,2.3,7.3,5.2,5.5,6.5,2.5,1,6.8,6.3,4.4,5.8,3.7,7.2,4.9,6.1,5.1,4.4,5.5,5.2,4.9,6.1,4.9,3.7,5.2,5.8,5,4.8,3.6,5.9,5.9,5.5,5,3.3,4.1,4.9,7.1,4.5,4.6,5.4,6.3,5.5,6.4,4.2,4.5,5.5,4.2,4.6,3.4,5,4.5,4.8,5.2,4.6,4.5,4.9,5.6,3.9,6.4,4.4,5.5,6.5,3.5,1.3,2.3,4.6,4.9,1.7,3.1,4.3,4.2,7.1,5.5,6,3.5,5.7,6.5,4.1,4.7,5.9,4.6,8,3.7,4.9,4.7,5.1,5,1,3.4,2.2,2.7,2.6,3.5,1.8,1.7,5.5,4.4,0.8,8.9,4.8,2.9,0,0.7,-0.2,0.7,0.2,0.1,0.4,0.7,-4.5,-3,-13.8,-2.7],[5.5,6.1,5.6,5.5,5.4,6.2,5.3,5.2,5,5.1,4.7,5.1,5.1,5.1,5.2,5.6,5,5.1,5.3,4.3,4.9,4.9,4,4.6,4.9,5.2,4.4,4.6,4.9,4.2,4.9,5.1,5,5.1,5.1,6.4,6.8,4.5,5.3,5.1,4.7,4.4,4.4,4.1,4.7,5.3,4.3,4.4,4,3.7,3.7,3.7,4.5,4.5,2.5,4.4,3.2,4.1,4.4,4.7,4,4.4,4.2,4.9,5.2,1.2,3,2.6,4.6,2.3,3.4,4.1,2.6,5.7,4.4,4.8,5.2,2.5,1.7,5.5,5.2,3.8,4.5,3.5,5.4,4,4.8,4.3,4.1,5,4.4,4,4.8,4.2,3.5,4.2,4.8,4.6,4.1,3.6,4.6,4.7,4.7,4,3.3,3.7,4.2,5.3,4.1,3.8,4.4,4.9,4.6,4.7,3.6,3.8,4.3,3.7,3.8,3.1,4.3,4,4,4.3,4,3.7,4.1,4.4,3.4,4.9,3.9,4.3,4.9,3.8,2.3,2.7,3.9,4,2.5,3,3.4,3.6,5.1,4.2,4.6,3.3,4.4,4.9,3.6,3.4,4.5,3.8,4.6,3.5,4.4,3.8,4.2,4,1.7,3.1,2.4,2.6,2.7,3.2,2.4,2.4,4.4,3.8,2,6.4,4.3,3,1.3,2,1.8,1.7,1.9,1.2,1.5,1.8,-1.5,-0.7,-7.3,0.2],["Below average","Below average","Average","Average","Average","Average","Average","Below average","Below average","Below average","Average","Below average","Below average","Below average","Below average","Above average","Below average","Below average","Below average","Below average","Below average","Average","Below average","Average","Average","Above average","Average","Below average","Below average","Average","Average","Above average","Average","Average","Average","Above average","Above average","Below average","Average","Above average","Average","Above average","Average","Above average","Above average","Above average","Above average","Below average","Average","Below average","Average","Above average","Average","Above average","Below average","Above average","Average","Below average","Above average","Above average","Average","Average","Above average","Above average","Above average","Above average","Above average","Average","Above average","Average","Above average","Above average","Above average","Average","Average","Below average","Above average","Average","Above average","Average","Below average","Above average","Average","Below average","Above average","Average","Below average","Below average","Below average","Average","Below average","Below average","Below average","Below average","Below average","Below average","Average","Average","Below average","Below average","Average","Average","Average","Below average","Below average","Average","Average","Average","Average","Average","Below average","Average","Average","Average","Average","Average","Average","Below average","Below average","Below average","Average","Average","Below average","Average","Below average","Below average","Below average","Average","Below average","Average","Below average","Above average","Above average","Above average","Below average","Below average","Average","Average","Below average","Below average","Average","Average","Above average","Above average","Above average","Average","Above average","Above average","Average","Below average","Above average","Above average","Above average","Average","Above average","Average","Above average","Average","Average","Average","Below average","Above average","Above average","Average","Average","Below average","Above average","Above average","Average","Above average","Above average","Above average","Above average","Above average","Below average","Above average","Above average","Above average","Average","Above average","Above average","Above average","Above average","Above average"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Fund.Number<\/th>\n      <th>Type<\/th>\n      <th>Assets<\/th>\n      <th>Fees<\/th>\n      <th>Expense.Ratio<\/th>\n      <th>Return.2009<\/th>\n      <th>X3.Year.Return<\/th>\n      <th>X5.Year.Return<\/th>\n      <th>Risk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="a-tidy-table" class="level1">
<h1>A Tidy Table</h1>
<p>Let me create a table to work with as a very small and manageable example to illustrate the concepts. I will create a table of <strong>Risk</strong> and <strong>Fees</strong> and then turn it into an R <code>data.frame</code>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_602c76f097534a66b252cb844deb12c5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Bonds<span class="sc">$</span>Fees, Bonds<span class="sc">$</span>Risk) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Var1          Var2 Freq
1   No Above average   37
2  Yes Above average   22
3   No       Average   49
4  Yes       Average   20
5   No Below average   44
6  Yes Below average   12</code></pre>
</div>
</div>
<p>This is <strong>tidy</strong> though the names are bad but that can be fixed. Let me store this <strong>long</strong> table as an object to manipulate and fix the names. <strong>Long</strong> and <strong>tidy</strong> are interchangeable in the way that I use the terms. The correspond to</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_cca4a9b28750ad082ff1d78e8a0bc85b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Bonds.Table.Long <span class="ot">&lt;-</span> <span class="fu">table</span>(Bonds<span class="sc">$</span>Fees, Bonds<span class="sc">$</span>Risk) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Fees =</span> Var1, <span class="at">Risk =</span> Var2, <span class="at">Count =</span> Freq)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>Bonds.Table.Long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Fees          Risk Count
1   No Above average    37
2  Yes Above average    22
3   No       Average    49
4  Yes       Average    20
5   No Below average    44
6  Yes Below average    12</code></pre>
</div>
</div>
<section id="pivoting-from-long-to-wide" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-from-long-to-wide">Pivoting from Long to Wide</h2>
<p>For display and because it is the most common way of seeing a table, I want to pivot it to wide form. Basically, I want to create a 2 by 3 table with the values of Fees on the rows and the values of Risk on the Columns and each cell representing the number of Funds for that row-column pair. <em>I should note it will actually be two-by-four because Fees is a margin of the table but the labels are treated as a variable.</em> I will need to start with the <code>Bonds.Table.Long</code> above and create named columns from the categories of <strong>Risk</strong> with values drawn from the counts of the number of funds with that combination of characteristics. The two key arguments in this case are where do the names come from <code>names_from</code> which is <strong>Risk</strong> and where do the values come from <code>values_from</code> which will be <strong>Count</strong>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_c1e340e88f7084b4d2dc3995b6aced6b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Bonds.Table.Wide <span class="ot">&lt;-</span> Bonds.Table.Long <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>Risk, <span class="at">values_from=</span>Count)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Bonds.Table.Wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Fees  `Above average` Average `Below average`
  &lt;fct&gt;           &lt;int&gt;   &lt;int&gt;           &lt;int&gt;
1 No                 37      49              44
2 Yes                22      20              12</code></pre>
</div>
</div>
<p>Wide data has “data” in the column names and the tidyverse and tidy data analysis are built upon the idea that we have <em>units</em> and <em>variables</em>, this has information on the <em>units</em> in the column names. Another way of putting it is that the values of <strong>Risk</strong> are spread across multiple columns of <u>values</u>. A proper <em>unit</em> here would be a Fee-Risk pair [now that we have tabulated the data and left the raw data behind].</p>
</section>
<section id="pivoting-from-wide-to-long" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-from-wide-to-long">Pivoting from Wide to Long</h2>
<p>To <u>tidy</u> these data, I need to put that data back into a <strong>row-centric</strong> format.</p>
<p>Let me use <code>pivot_longer</code> for that. Here, I need to tell R what variable the column names need to become (in quotes) and what variable the values need to become (also in quotes). I want the names of variables currently called <code>Above Average, Average, Below Average</code> to become [or re-become] <strong>Risk</strong> and the values to become <strong>Count</strong> because they will measure how many bond funds in the original data represent that Fee-Risk pair. <strong>I should point out that spaces in column names are a nightmare. I would have been far better off to fix them while they are values of the Risk variable before pivoting but I did not. To address them, I will need tickmarks</strong> I will show three ways to do this.</p>
<ol type="1">
<li><p>Negation because I want to pivot every column but <strong>Fees</strong>.</p></li>
<li><p>I will enclose them in tickmarks.</p></li>
<li><p>I will fix the names using <code>janitor</code> and its <code>clean_names</code> function.</p></li>
</ol>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Negation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Tickmarks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Cleaned Names</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>First, let me do it by just telling R to use ! [not] Fees.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_82bcc6772a607837f2f959ed4f63a8ca">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>BTL <span class="ot">&lt;-</span> Bonds.Table.Wide <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="sc">-</span>Fees, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Risk"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>BTL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Fees  Risk          Count
  &lt;fct&gt; &lt;chr&gt;         &lt;int&gt;
1 No    Above average    37
2 No    Average          49
3 No    Below average    44
4 Yes   Above average    22
5 Yes   Average          20
6 Yes   Below average    12</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_275790f7544c4cb92cab6d6abf6b3522">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>BTL2 <span class="ot">&lt;-</span> Bonds.Table.Wide <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Above average</span><span class="st">`</span>,Average,<span class="st">`</span><span class="at">Below average</span><span class="st">`</span>), </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Risk"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>BTL2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Fees  Risk          Count
  &lt;fct&gt; &lt;chr&gt;         &lt;int&gt;
1 No    Above average    37
2 No    Average          49
3 No    Below average    44
4 Yes   Above average    22
5 Yes   Average          20
6 Yes   Below average    12</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>If we want to clean the names, a package introduced in class for tables using the pipe operator – the <code>janitor</code> package and its <code>tabyl</code> function – gives us a useful function called <code>clean_names</code>; it has a few arguments and is quite useful for transliteration from non-ASCII character sets, also. The default is the “snake” case that will replace the spaces with underscores. There are quite a few options for the argument, you can explore them by changing the argument among the options in quotations below. Be careful about curly quotes and such, they are not valid ASCII characters and computer languages will complain. The options are:</p>
<p><code>"snake", "small_camel", "big_camel", "screaming_snake", "parsed", "mixed", "lower_upper", "upper_lower", "swap", "all_caps", "lower_camel", "upper_camel", "internal_parsing", "none", "flip", "sentence", "random", "title"</code></p>
<p>I intend to use the “mixed” type which maintains the capitalization but replaces spaces with <code>_</code> which is as close as I can get to the initial names with spaces while separating the lines. Camel case would eliminate the spaces.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_a26a209b18b87e35ad154c8cc6f7d8ca">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Bonds.Table.Wide.Clean <span class="ot">&lt;-</span> Bonds.Table.Wide <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>(<span class="st">"mixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now I have names that I don’t need tickmarks for. I want to make the columns <code>Above_average, Average,</code> and <code>Below_average</code> into the categories of the <strong>Risk</strong> variable with values going into <strong>Count</strong>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_17cdac169529eab092f66b7bf286b1f7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>BTL3 <span class="ot">&lt;-</span> Bonds.Table.Wide.Clean <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(Above_average,Average,Below_average), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Risk"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>BTL3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Fees  Risk          Count
  &lt;fct&gt; &lt;chr&gt;         &lt;int&gt;
1 No    Above_average    37
2 No    Average          49
3 No    Below_average    44
4 Yes   Above_average    22
5 Yes   Average          20
6 Yes   Below_average    12</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="a-more-complicated-example-from-the-wild-intel-10-k" class="level1">
<h1>A More Complicated Example From the Wild: Intel 10-k</h1>
<p>I am going to use an Intel [INTC] Income Statement that I obtained from their website. I chose the most recent one in Excel format which I have posted to my Github along with the income statement as .csv.</p>
<ul>
<li><a href="https://github.com/robertwwalker/DADMStuff/raw/master/Intel_Financial_Report-2022.xlsx">Download the Excel file</a></li>
<li><a href="https://github.com/robertwwalker/DADMStuff/raw/master/Intel_Financial_Report-2022-IS.csv">Download the Single Income Statement Sheet Extracted and Saved as .csv</a></li>
<li><a href="https://github.com/robertwwalker/DADMStuff/blob/master/Intel_Financial_Report-2022-IS.csv">View the .csv on Github</a></li>
</ul>
<p>I want to import the data from .csv. If you follow the link above to view the Income Statement on Github you will see the extracted .csv file.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_b82e6ff07ea333f2790aefe92562634c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Intel.IS <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/robertwwalker/DADMStuff/raw/master/Intel_Financial_Report-2022-IS.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 22 Columns: 4
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(4): Consolidated Statements of Income - USD ($) shares in Millions, $ i...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...3`
• `` -&gt; `...4`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(Intel.IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7cf4538d39972efb723d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7cf4538d39972efb723d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],[null,"Income Statement [Abstract]","Net revenue","Cost of sales","Gross margin","Research and development","Marketing, general and administrative","Restructuring and other charges","Operating expenses","Operating income","Gains (losses) on equity investments, net","Interest and other, net","Income before taxes","Provision for (benefit from) taxes","Net income","Net loss attributable to non-controlling interest","Net income attributable to Intel","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—diluted","Weighted average shares of common stock outstanding:","Basic (shares)","Diluted (shares)"],["Dec. 31, 2022"," ","$ 63,054","36,188","26,866","17,528","7,002","2","24,532","2,334","4,268","1,166","7,768","(249)","8,017","3","$ 8,014","$ 1.95","$ 1.94"," ","4,108","4,123"],["Dec. 25, 2021"," ","$ 79,024","35,209","43,815","15,190","6,543","2,626","24,359","19,456","2,729","(482)","21,703","1,835","19,868","0","$ 19,868","$ 4.89","$ 4.86"," ","4,059","4,090"],["Dec. 26, 2020"," ","$ 77,867","34,255","43,612","13,556","6,180","198","19,934","23,678","1,904","(504)","25,078","4,179","20,899","0","$ 20,899","$ 4.98","$ 4.94"," ","4,199","4,232"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Consolidated Statements of Income - USD ($) shares in Millions, $ in Millions<\/th>\n      <th>12 Months Ended<\/th>\n      <th>...3<\/th>\n      <th>...4<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>First, notice three identification lines that I will want to drop, lines 1, 3, and 21. There are also some dollar signs and commas separating the amounts for formatting purposes that I need to fix; they currently prevent the data from being read as numeric. For now, I will skip line 1 (<code>skip=1</code>) and force the columns to be character, numeric, numeric, numeric; <code>read_csv</code> abbreviates those with quoted “cnnn”: <code>col_types="cnnn"</code>. I also want to trim whitespaces with <code>trim_ws=T</code> I learned this from the help.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_acc0e9b8334ef1f1d18dcc3133917454">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Intel.IS <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/robertwwalker/DADMStuff/raw/master/Intel_Financial_Report-2022-IS.csv"</span>, <span class="at">skip=</span><span class="dv">1</span>, <span class="at">col_types =</span> <span class="st">"cnnn"</span>, <span class="at">trim_ws=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(Intel.IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a9be571ae83cb0d3a817" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a9be571ae83cb0d3a817">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"],["Income Statement [Abstract]","Net revenue","Cost of sales","Gross margin","Research and development","Marketing, general and administrative","Restructuring and other charges","Operating expenses","Operating income","Gains (losses) on equity investments, net","Interest and other, net","Income before taxes","Provision for (benefit from) taxes","Net income","Net loss attributable to non-controlling interest","Net income attributable to Intel","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—diluted","Weighted average shares of common stock outstanding:","Basic (shares)","Diluted (shares)"],[null,63054,36188,26866,17528,7002,2,24532,2334,4268,1166,7768,249,8017,3,8014,1.95,1.94,null,4108,4123],[null,79024,35209,43815,15190,6543,2626,24359,19456,2729,482,21703,1835,19868,0,19868,4.89,4.86,null,4059,4090],[null,77867,34255,43612,13556,6180,198,19934,23678,1904,504,25078,4179,20899,0,20899,4.98,4.94,null,4199,4232]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>...1<\/th>\n      <th>Dec. 31, 2022<\/th>\n      <th>Dec. 25, 2021<\/th>\n      <th>Dec. 26, 2020<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>There are still warnings. Data in the wild are messy but these are understandable. The warnings tell me that I can run a command called <code>problems</code> from the <code>vroom</code> library to discover them.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_3c8d904266b4e7949968eb5ef326bd24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vroom)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">problems</span>(Intel.IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
    row   col expected actual file 
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;
1     2     2 a number &nbsp;      ""   
2     2     3 a number &nbsp;      ""   
3     2     4 a number &nbsp;      ""   
4    20     2 a number &nbsp;      ""   
5    20     3 a number &nbsp;      ""   
6    20     4 a number &nbsp;      ""   </code></pre>
</div>
</div>
<p>Those are the original rows 3 and 21 that I wished to skip (recall I skipped 1). I have one unnamed column and three columns that are named by the date of the Income Statement. Let me rename the unnamed column to be Entry and then filter out the rows with <strong>Entry</strong> equal to “Income Statement [Abstract]” and “Weighted average shares of common stock outstanding:” as those are the identified issues.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_f39de90962ca39446fc9fea41f323921">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Intel.IS.Clean <span class="ot">&lt;-</span> Intel.IS <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Entry =</span> ...<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Entry <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Income Statement [Abstract]"</span>,<span class="st">"Weighted average shares of common stock outstanding:"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s view what we have now.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_78e8b9a4151d7c62b375a7140da982df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(Intel.IS.Clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b7581baf08d23bf79d12" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b7581baf08d23bf79d12">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["Net revenue","Cost of sales","Gross margin","Research and development","Marketing, general and administrative","Restructuring and other charges","Operating expenses","Operating income","Gains (losses) on equity investments, net","Interest and other, net","Income before taxes","Provision for (benefit from) taxes","Net income","Net loss attributable to non-controlling interest","Net income attributable to Intel","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—diluted","Basic (shares)","Diluted (shares)"],[63054,36188,26866,17528,7002,2,24532,2334,4268,1166,7768,249,8017,3,8014,1.95,1.94,4108,4123],[79024,35209,43815,15190,6543,2626,24359,19456,2729,482,21703,1835,19868,0,19868,4.89,4.86,4059,4090],[77867,34255,43612,13556,6180,198,19934,23678,1904,504,25078,4179,20899,0,20899,4.98,4.94,4199,4232]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Entry<\/th>\n      <th>Dec. 31, 2022<\/th>\n      <th>Dec. 25, 2021<\/th>\n      <th>Dec. 26, 2020<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>That’s good. Now to pivot this. After pivoting, I want to mutate the period variable to be a proper date format. I also want to change the Entry to a factor variable so that the filter option in <code>datatable</code> will allow us to see just one accounting item by clicking on the available options – Click in the box <strong>All</strong> at the top of the column <strong>Entry</strong> to see the scroll menu. <code>datatable</code> has many neat features.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_6247a5bda7dbd4c079d9d2759cee8fbb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Intel.Tidy <span class="ot">&lt;-</span> Intel.IS.Clean <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Dec. 31, 2022</span><span class="st">`</span>,<span class="st">`</span><span class="at">Dec. 25, 2021</span><span class="st">`</span>,<span class="st">`</span><span class="at">Dec. 26, 2020</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">"period"</span>, <span class="at">values_to =</span> <span class="st">"Quantity"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Entry =</span> <span class="fu">as.factor</span>(Entry), <span class="at">date =</span> <span class="fu">as.Date</span>(period, <span class="at">format=</span><span class="st">"%b. %d,%Y"</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(Intel.Tidy, <span class="at">filter =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f479f0bb3356b11dde4a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f479f0bb3356b11dde4a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Basic (shares)&quot;,&quot;Cost of sales&quot;,&quot;Diluted (shares)&quot;,&quot;Earnings per share attributable to Intel—basic&quot;,&quot;Earnings per share attributable to Intel—diluted&quot;,&quot;Gains (losses) on equity investments, net&quot;,&quot;Gross margin&quot;,&quot;Income before taxes&quot;,&quot;Interest and other, net&quot;,&quot;Marketing, general and administrative&quot;,&quot;Net income&quot;,&quot;Net income attributable to Intel&quot;,&quot;Net loss attributable to non-controlling interest&quot;,&quot;Net revenue&quot;,&quot;Operating expenses&quot;,&quot;Operating income&quot;,&quot;Provision for (benefit from) taxes&quot;,&quot;Research and development&quot;,&quot;Restructuring and other charges&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"79024\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1608940800000\" data-max=\"1672444800000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57"],["Net revenue","Net revenue","Net revenue","Cost of sales","Cost of sales","Cost of sales","Gross margin","Gross margin","Gross margin","Research and development","Research and development","Research and development","Marketing, general and administrative","Marketing, general and administrative","Marketing, general and administrative","Restructuring and other charges","Restructuring and other charges","Restructuring and other charges","Operating expenses","Operating expenses","Operating expenses","Operating income","Operating income","Operating income","Gains (losses) on equity investments, net","Gains (losses) on equity investments, net","Gains (losses) on equity investments, net","Interest and other, net","Interest and other, net","Interest and other, net","Income before taxes","Income before taxes","Income before taxes","Provision for (benefit from) taxes","Provision for (benefit from) taxes","Provision for (benefit from) taxes","Net income","Net income","Net income","Net loss attributable to non-controlling interest","Net loss attributable to non-controlling interest","Net loss attributable to non-controlling interest","Net income attributable to Intel","Net income attributable to Intel","Net income attributable to Intel","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—basic","Earnings per share attributable to Intel—diluted","Earnings per share attributable to Intel—diluted","Earnings per share attributable to Intel—diluted","Basic (shares)","Basic (shares)","Basic (shares)","Diluted (shares)","Diluted (shares)","Diluted (shares)"],["Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020","Dec. 31, 2022","Dec. 25, 2021","Dec. 26, 2020"],[63054,79024,77867,36188,35209,34255,26866,43815,43612,17528,15190,13556,7002,6543,6180,2,2626,198,24532,24359,19934,2334,19456,23678,4268,2729,1904,1166,482,504,7768,21703,25078,249,1835,4179,8017,19868,20899,3,0,0,8014,19868,20899,1.95,4.89,4.98,1.94,4.86,4.94,4108,4059,4199,4123,4090,4232],["2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26","2022-12-31","2021-12-25","2020-12-26"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Entry<\/th>\n      <th>period<\/th>\n      <th>Quantity<\/th>\n      <th>date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="plot-some-financials" class="level2">
<h2 class="anchored" data-anchor-id="plot-some-financials">Plot Some Financials</h2>
<p>Finally, for this, let’s plot Intel’s <strong>Net income</strong>. I will need to use the <code>scales</code> packages to get this into millions of dollars.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_d61876756bd2e094a673e463fde5fd07">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Intel.Tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Entry <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Net income"</span>,<span class="st">"Operating income"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>Quantity, <span class="at">color=</span>Entry) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>() <span class="sc">+</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">suffix=</span><span class="st">" Billion"</span>, <span class="at">scale=</span><span class="fl">1e-3</span>)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Intel Income from 10-k"</span>, <span class="at">x=</span><span class="st">"Annual Report Date"</span>, <span class="at">color=</span><span class="st">"Accounting Entry"</span>, <span class="at">y=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="a-really-wide-and-messy-example-weather" class="level1">
<h1>A Really Wide and Messy Example: Weather</h1>
<p>The following weather.gov site contains <a href="https://www.weather.gov/wrh/climate?wfo=pqr">Portland’s weather almanac</a>. A link to a csv of all the data can be downloaded directly into R. The datatable is huge because it covers four types of data – high, low, precipitation, and snow, from October 1940 to the present. It’s also got some random characters in it that are undefined.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_d90f015be3f9350b15eb7201659d7b67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>NWS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">"https://www.weather.gov/source/pqr/climate/webdata/Portland_dailyclimatedata.csv"</span>), <span class="at">skip=</span><span class="dv">6</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"M"</span>,<span class="st">"-"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Variable =</span> X)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(NWS, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     YR MO Variable   X1   X2   X3   X4   X5   X6   X7   X8   X9  X10  X11  X12
1  1940 10       TX &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
2  1940 10       TN &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
3  1940 10       PR &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
4  1940 10       SN &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
5  1940 11       TX   52   53   47   55   51   58   56   50   48   47   46   45
6  1940 11       TN   40   38   36   32   42   46   46   42   35   34   35   33
7  1940 11       PR 0.17 0.02    T    0 0.07 0.28 0.85 0.29 0.02 0.01 0.01    0
8  1940 11       SN    0    0    0    0    0    0    0    0    0    0    0    0
9  1940 12       TX   51   53   52   51   56   54   50   51   48   50   46   45
10 1940 12       TN   42   40   42   42   44   37   34   35   32   26   34   28
    X13 X14 X15 X16  X17  X18 X19  X20  X21 X22  X23  X24 X25 X26  X27  X28
1    75  70  64  72   72   78  78   64   63  61   58   57  57  57   56   53
2    57  53  52  50   58   58  59   54   48  41   53   48  41  38   37   45
3  0.01   T   T   0 0.13    0   T 0.14 0.05   0 0.63 1.03   0   0    T 0.18
4     0   0   0   0    0    0   0    0    0   0    0    0   0   0    0    0
5    45  47  53  49   46   49  46   49   50  44   42   44  51  44   45   59
6    34  33  28  27   36   30  29   36   33  28   37   35  37  36   38   43
7     0   0   0   0 0.29 0.01   0 0.37    T   0 0.12 0.62   0   0 0.51 0.89
8     0   0   0   0    0    0   0    0    0   0    0    0   0   0    0    0
9    43  40  39  39   41   41  45   46   62  60   56   53  54  45   50   51
10   27  25  29  33   35   34  35   41   39  39   42   42  42  40   38   36
    X29 X30  X31 AVG.or.Total
1    59  59   52         &lt;NA&gt;
2    48  50   46         &lt;NA&gt;
3  0.58 0.5 0.25         &lt;NA&gt;
4     0   0    0            0
5    57  45 &lt;NA&gt;         49.1
6    40  39 &lt;NA&gt;         35.9
7     T   T &lt;NA&gt;         4.53
8     0   0 &lt;NA&gt;            0
9    43  44   45         48.5
10   35  37   32           36</code></pre>
</div>
</div>
<p>Days of the month are most of the variable names. There is also a YR – year, a MO – month, and what variable – TX is high temperature, TN is low temperature, PR is precipitation, and SN is snow. To get this workable, I will need both a <code>pivot_longer</code> and a <code>pivot_wider</code>. What I want is a date column, high, low, precipitation, and snow.</p>
<section id="removing-junk" class="level3">
<h3 class="anchored" data-anchor-id="removing-junk">Removing Junk</h3>
<p>One thing that will prove troublesome is that <code>/A</code> appears in a few places. I want to remove it. I will ask R to find all of the character columns and remove <code>/A</code>. I believe that this stands for trace accumulation. <code>where</code> is a helper to select columns with a set of characteristics and across allows me to transform those column-wise for all matching columns.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_ab7448b25240391cc21b2e801a3f5bbe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>NWS <span class="ot">&lt;-</span> NWS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="fu">str_remove</span>(.x, <span class="st">"/A"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now those are gone. Now a few other cleaning steps. I first create a daily dataset by removing the Averages/Totals which are the last column. I also want to rename the columns to <code>Day.*</code> rather than <code>X*</code> for numbers 1 to 31.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_ed46be4a9f9c985d44d706b3e11f6477">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>NWS.Daily <span class="ot">&lt;-</span> NWS <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>AVG.or.Total)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NWS.Daily) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"YR"</span>,<span class="st">"MO"</span>,<span class="st">"Variable"</span>,<span class="fu">paste0</span>(<span class="st">"Day."</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">31</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now I can pivot the to long form of the data by choosing to pivot all columns that start with <strong>Day.</strong></p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_84500ccfeb67e76773746bbb58ea1714">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>NWS.Daily <span class="ot">&lt;-</span> NWS.Daily <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(., <span class="at">cols=</span><span class="fu">starts_with</span>(<span class="st">"Day."</span>), <span class="at">names_to =</span> <span class="st">"Day"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(NWS.Daily)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
     YR    MO Variable Day   value
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
1  1940    10 TX       Day.1 &lt;NA&gt; 
2  1940    10 TX       Day.2 &lt;NA&gt; 
3  1940    10 TX       Day.3 &lt;NA&gt; 
4  1940    10 TX       Day.4 &lt;NA&gt; 
5  1940    10 TX       Day.5 &lt;NA&gt; 
6  1940    10 TX       Day.6 &lt;NA&gt; </code></pre>
</div>
</div>
<p>Now to get rid of the Day. prefix to only keep the numbers and then pivot the four distinct variable back to columns. I then want to recode some items, <code>T</code> is trace so I want to set it to 0.005 for both snow and precipitation before verifying that all the numeric columns are numeric and then combine the years, months, and days together into something that can be formatted as a date.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_d1378b87cda2acab869ca65b3c0eb664">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>NWS.Daily <span class="ot">&lt;-</span> NWS.Daily <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Day =</span> <span class="fu">str_remove</span>(Day, <span class="st">"Day."</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(., </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="st">"Variable"</span>, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PR =</span> <span class="fu">recode</span>(PR, <span class="at">T =</span> <span class="st">"O.005"</span>), </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">SN =</span> <span class="fu">recode</span>(SN, <span class="at">T =</span> <span class="st">"O.005"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TX =</span> <span class="fu">as.numeric</span>(TX), </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">TN =</span> <span class="fu">as.numeric</span>(TN), </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">PR =</span> <span class="fu">as.numeric</span>(PR), </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">SN =</span> <span class="fu">as.numeric</span>(SN), </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(MO,Day,YR,<span class="at">sep=</span><span class="st">"-"</span>), <span class="at">format=</span><span class="st">"%m-%d-%Y"</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>NWS.Daily <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 535 × 8
      YR    MO Day      TX    TN    PR    SN date  
   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;
 1  1940    11 31       NA    NA    NA    NA NA    
 2  1941     2 29       NA    NA    NA    NA NA    
 3  1941     2 30       NA    NA    NA    NA NA    
 4  1941     2 31       NA    NA    NA    NA NA    
 5  1941     4 31       NA    NA    NA    NA NA    
 6  1941     6 31       NA    NA    NA    NA NA    
 7  1941     9 31       NA    NA    NA    NA NA    
 8  1941    11 31       NA    NA    NA    NA NA    
 9  1942     2 29       NA    NA    NA    NA NA    
10  1942     2 30       NA    NA    NA    NA NA    
# … with 525 more rows</code></pre>
</div>
</div>
<p>The output above shows me the first collection of rows where the <strong>date</strong> variable I created is missing. Those are erroneous dates that are created because there is a cell for February 30 in the grid of original data. I want to remove those and then to filter out rows with no valid values on any of the four quantitative variables. This should give me clean data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_9ba0f016570f501019574fbcccd5210a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>NWS.Daily.Clean <span class="ot">&lt;-</span> NWS.Daily <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(date))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(TX) <span class="sc">&amp;</span> <span class="fu">is.na</span>(TN) <span class="sc">&amp;</span> <span class="fu">is.na</span>(PR) <span class="sc">&amp;</span> <span class="fu">is.na</span>(SN))) </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(NWS.Daily.Clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
     YR    MO Day      TX    TN    PR    SN date      
  &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
1  1940    10 13       75    57  0.01     0 1940-10-13
2  1940    10 14       70    53 NA        0 1940-10-14
3  1940    10 15       64    52 NA        0 1940-10-15
4  1940    10 16       72    50  0        0 1940-10-16
5  1940    10 17       72    58  0.13     0 1940-10-17
6  1940    10 18       78    58  0        0 1940-10-18</code></pre>
</div>
</div>
</section>
<section id="a-plot-to-test-the-data" class="level2">
<h2 class="anchored" data-anchor-id="a-plot-to-test-the-data">A Plot to Test the Data</h2>
<p>Let me plot the data to verify the result.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_6dbb0f4379d8397ba01cdcd17bc7d315">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Plot.All <span class="ot">&lt;-</span> NWS.Daily.Clean <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Midpoint =</span> (TX<span class="sc">+</span>TN)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mid.Temp =</span> <span class="fu">slide_dbl</span>(Midpoint, mean, <span class="at">.before=</span><span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>date) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>Mid.Temp, <span class="at">alpha=</span><span class="fl">0.001</span>, <span class="at">color=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>() <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>TN, <span class="at">ymax=</span>TX), <span class="at">alpha=</span><span class="fl">0.4</span>, <span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  hrbrthemes<span class="sc">::</span><span class="fu">theme_ipsum_rc</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Portland Temperatures"</span>, <span class="at">y=</span><span class="st">"Degrees Fahrenheit"</span>, <span class="at">caption=</span><span class="st">"The line is the 7 - Day Moving Average"</span>) <span class="sc">+</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">alpha=</span><span class="st">"none"</span>, <span class="at">color=</span><span class="st">"none"</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>Plot.Mini <span class="ot">&lt;-</span> NWS.Daily.Clean <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2019-01-01"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Midpoint =</span> (TX<span class="sc">+</span>TN)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mid.Temp =</span> <span class="fu">slide_dbl</span>(Midpoint, mean, <span class="at">.before=</span><span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>date) <span class="sc">+</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>Mid.Temp, <span class="at">alpha=</span><span class="fl">0.005</span>, <span class="at">color=</span><span class="st">"red"</span>)) <span class="sc">+</span>  <span class="fu">scale_x_date</span>() <span class="sc">+</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>TN, <span class="at">ymax=</span>TX), <span class="at">alpha=</span><span class="fl">0.4</span>, <span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  hrbrthemes<span class="sc">::</span><span class="fu">theme_ipsum_rc</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Portland Temperatures"</span>, <span class="at">y=</span><span class="st">"Degrees Fahrenheit"</span>, <span class="at">caption=</span><span class="st">"The line is the 7 - Day Moving Average"</span>) <span class="sc">+</span> </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">alpha=</span><span class="st">"none"</span>, <span class="at">colour=</span><span class="st">"none"</span>)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>Plot.All <span class="sc">/</span> Plot.Mini</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>